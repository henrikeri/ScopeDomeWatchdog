<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:ScopeDomeWatchdog.Nina">

    <!-- Options DataTemplate for ScopeDomeWatchdog plugin settings -->
    <!-- Key must match AssemblyTitle + "_Options" pattern -->
    <DataTemplate x:Key="ScopeDomeWatchdog_Options">
        <StackPanel DataContext="{Binding}" Margin="10">
            
            <!-- Header -->
            <TextBlock Text="ScopeDome Watchdog Settings" 
                       FontSize="18" 
                       FontWeight="Bold" 
                       Margin="0,0,0,20"/>
            
            <!-- Tray Application Section -->
            <GroupBox Header="Tray Application" Margin="0,0,0,15">
                <StackPanel Margin="10">
                    
                    <!-- Path input with browse button -->
                    <TextBlock Text="Tray App Path:" Margin="0,0,0,5"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBox Grid.Column="0" 
                                 Text="{Binding TrayAppPath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 VerticalAlignment="Center"
                                 Margin="0,0,10,0"/>
                        
                        <Button Grid.Column="1" 
                                Content="Browse..." 
                                Width="80"
                                Command="{Binding BrowseTrayAppCommand}"
                                ToolTip="Browse for ScopeDomeWatchdog.Tray.exe"/>
                    </Grid>
                    
                    <!-- Status and Launch section -->
                    <StackPanel Orientation="Horizontal" Margin="0,15,0,0">
                        
                        <!-- Status indicator -->
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Ellipse Width="12" Height="12" Margin="0,0,8,0">
                                <Ellipse.Style>
                                    <Style TargetType="Ellipse">
                                        <Setter Property="Fill" Value="#FF4444"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsTrayAppRunning}" Value="True">
                                                <Setter Property="Fill" Value="#44FF44"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Ellipse.Style>
                            </Ellipse>
                            <TextBlock VerticalAlignment="Center">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Text" Value="Tray App: Not Running"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsTrayAppRunning}" Value="True">
                                                <Setter Property="Text" Value="Tray App: Running"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>
                        
                        <!-- Launch button -->
                        <Button Content="Launch Tray App" 
                                Width="120"
                                Margin="20,0,0,0"
                                Command="{Binding LaunchTrayAppCommand}"
                                ToolTip="Start the ScopeDome Watchdog tray application">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsTrayAppRunning}" Value="True">
                                            <Setter Property="IsEnabled" Value="False"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        
                        <!-- Refresh button -->
                        <Button Content="â†»" 
                                Width="30"
                                Margin="10,0,0,0"
                                Command="{Binding RefreshStatusCommand}"
                                ToolTip="Refresh status"/>
                    </StackPanel>
                    
                    <!-- Help text -->
                    <TextBlock Text="The tray application monitors the ScopeDome connection and manages automatic reconnection."
                               TextWrapping="Wrap"
                               Opacity="0.7"
                               Margin="0,15,0,0"
                               FontSize="11"/>
                    
                </StackPanel>
            </GroupBox>
            
            <!-- Info Section -->
            <GroupBox Header="About" Margin="0,0,0,10">
                <StackPanel Margin="10">
                    <TextBlock TextWrapping="Wrap" Margin="0,0,0,10">
                        <Run Text="ScopeDome Watchdog" FontWeight="Bold"/>
                        <LineBreak/>
                        <Run Text="Monitors and automatically reconnects your ScopeDome when USB disconnections occur."/>
                    </TextBlock>
                    
                    <TextBlock TextWrapping="Wrap" Opacity="0.7" FontSize="11">
                        <Run Text="The tray app runs in the background and detects dome disconnections. "/>
                        <Run Text="When a disconnection is detected, it automatically triggers a Shelly relay power cycle "/>
                        <Run Text="and waits for the dome to reconnect. The NINA trigger pauses your sequence during this process."/>
                    </TextBlock>
                </StackPanel>
            </GroupBox>
            
        </StackPanel>
    </DataTemplate>
    
</ResourceDictionary>
